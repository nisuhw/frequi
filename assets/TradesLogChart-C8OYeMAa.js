import{d as v,N as $,p as g,c as Z,a as x,e as T,y as k,q as w,f as d,x as U,b as W,a9 as Y,B as L,b2 as j,r as J,b8 as K,o as Q,b9 as X,Y as tt,I as V,ba as et,E as ot}from"./index-BoH2X4lE.js";import{u as O,E as S,i as I,a as A,b as B,c as D,d as R}from"./installCanvasRenderer-Db7nzp7W.js";import{e as z,o as M,c as N,i as E,b as at,d as F,f as st,k as rt}from"./chartZoom-BxGMNc4V.js";function nt(l,a){const r=Math.min(...l),m=(Math.max(...l)-r)*1.01/a,u=[...Array(a).keys()].map(s=>[Math.round((r+s*m)*1e3)/1e3,0]);for(let s=0;s<l.length;s++){const e=Math.min(Math.floor((l[s]-r)/m),a-1);isNaN(e)||u[e][1]++}return u}const it={class:"flex flex-col h-full relative"},lt={class:"grow mb-2"},C="Trade count",ct=v({__name:"ProfitDistributionChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(l){O([M,I,A,N,B,D,R]);const a=l,r=$(),b=[{text:"10",value:10},{text:"15",value:15},{text:"20",value:20},{text:"25",value:25},{text:"50",value:50}],m=g(()=>{const s=a.trades.map(e=>e.profit_ratio);return nt(s,r.profitDistributionBins)}),u=g(()=>({title:{text:"Profit distribution",left:"center",show:a.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:m.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[C],right:"5%",selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:C,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],grid:{...z,bottom:50},series:[{type:"bar",name:C,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(s,e)=>{const p=Y;return x(),Z("div",it,[T("div",lt,[l.trades?(x(),k(d(S),{key:0,option:d(u),autoresize:"",theme:d(r).chartTheme},null,8,["option","theme"])):w("",!0)]),T("div",{class:U(["z-2 absolute fixed-top flex items-center gap-10 ms-2",{"mx-auto":l.showTitle}]),"label-for":"input-bins",size:"sm"},[e[1]||(e[1]=T("label",{for:"input-bins"},"Bins",-1)),W(p,{id:"input-bins",modelValue:d(r).profitDistributionBins,"onUpdate:modelValue":e[0]||(e[0]=_=>d(r).profitDistributionBins=_),size:"small","option-label":"text","option-value":"value",class:"mt-1",options:b},null,8,["modelValue"])],2)])}}}),_t=L(ct,[["__scopeId","data-v-17464fd3"]]),P="Profit",pt=v({__name:"CumProfitChart",props:{trades:{},openTrades:{default:()=>[]},showTitle:{type:Boolean,default:!0},profitColumn:{default:"profit_abs"}},setup(l){O([M,E,I,A,N,at,B,D,R]);const a=l,r=$(),b=j(),m=J(),u=g(()=>a.openTrades.reduce((t,n)=>t+(n.total_profit_abs??n[a.profitColumn]??0),0)),s=g(()=>{const t={},n=a.trades.slice().sort((c,h)=>c.close_timestamp>h.close_timestamp?1:-1);let i=0,y=!0;for(let c=0,h=n.length;c<h;c+=1){const o=n[c];y&&(y=!1,t[o.open_timestamp]?t[o.open_timestamp][o.botId]=i:t[o.open_timestamp]={profit:i,[o.botId]:i}),o.close_timestamp&&o[a.profitColumn]&&(i+=o[a.profitColumn],t[o.close_timestamp]?(t[o.close_timestamp].profit+=o[a.profitColumn],t[o.close_timestamp][o.botId]?t[o.close_timestamp][o.botId]+=o[a.profitColumn]:t[o.close_timestamp][o.botId]=i):t[o.close_timestamp]={profit:i,[o.botId]:i})}const f=Object.entries(t).map(([c,h])=>({date:parseInt(c,10),profit:h.profit}));if(a.openTrades.length>0){let c=0,h=0;if(f.length>0){const G=f[f.length-1];c=G.profit??0,h=G.date??0}else h=a.openTrades[0].open_timestamp;const o=(c??0)+u.value;f.push({date:h,currentProfit:c});const q=Date.now()+24*60*60*1e3;f.push({date:q,currentProfit:o})}return f});function e(t=!1){const{colorProfit:n,colorLoss:i}=b;return{dataset:{dimensions:["date","profit","currentProfit"],source:s.value},series:[{type:"line",name:"currentProfit",animation:t,lineStyle:{color:u.value>0?n:i,type:"dotted"},itemStyle:{color:u.value>0?n:i},encode:{x:"date",y:"currentProfit"}},{type:"line",name:P,animation:t,step:"end",lineStyle:{color:r.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:r.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]}}function p(t=!1){const n=e(t);m.value?.setOption(n,{replaceMerge:["series","dataset"]})}const _=K(()=>a.trades,()=>{const t={title:{text:"Cumulative Profit",left:"center",show:a.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:i=>{const y=i[0].data.profit,f=i[0].data.currentProfit,c=f?`Projected profit (incl. unrealized): ${V(f,3)}`:`Profit: ${V(y,3)}`;return`${et(i[1].data.date)}<br />${i[1].marker}${c}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[P],right:"5%",selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:P,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{...z},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...F}]},n=e(!1);return t.series=n.series,t.dataset=n.dataset,t});return Q(()=>{}),X(()=>a.openTrades,()=>{p()},{throttle:60*1e3}),tt(()=>r.chartTheme,()=>{_.trigger()}),(t,n)=>t.trades?(x(),k(d(S),{key:0,ref_key:"chart",ref:m,option:d(_),theme:d(r).chartTheme,autoresize:""},null,8,["option","theme"])):w("",!0)}}),bt=L(pt,[["__scopeId","data-v-ddcc5ca5"]]),H="Profit %",mt="#9be0a8",dt=v({__name:"TradesLogChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(l){O([M,E,I,A,N,B,D,R,st,rt]);const a=l,r=$(),b=j(),m=g(()=>{const s=[],e=a.trades.slice(0).sort((p,_)=>p.close_timestamp>_.close_timestamp?1:-1);for(let p=0,_=e.length;p<_;p+=1){const t=e[p],n=[p,(t.profit_ratio*100).toFixed(2),t.pair,t.botName,ot(t.close_timestamp),t.is_short===void 0||!t.is_short?"Long":"Short"];s.push(n)}return s}),u=g(()=>{const s=m.value.length>0?(1-50/m.value.length)*100:100;return{title:{text:"Trades log",left:"center",show:a.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:m.value},tooltip:{trigger:"axis",formatter:e=>{const p=e[0].data[3]?` | ${e[0].data[3]}`:"";return`${e[0].data[2]} | ${e[0].data[5]} ${p}<br>${e[0].data[4]}<br>Profit ${e[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",show:!1},yAxis:[{type:"value",name:H,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{...z,left:80},dataZoom:[{type:"inside",start:s,end:100},{bottom:10,start:s,end:100,...F}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:b.colorLoss},{min:0,color:b.colorProfit}]}],series:[{type:"bar",name:H,barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:r.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:mt}}]}});return(s,e)=>l.trades.length>0?(x(),k(d(S),{key:0,option:d(u),autoresize:"",theme:d(r).chartTheme},null,8,["option","theme"])):w("",!0)}}),gt=L(dt,[["__scopeId","data-v-1368a762"]]);export{gt as _,bt as a,_t as b};
//# sourceMappingURL=TradesLogChart-C8OYeMAa.js.map
