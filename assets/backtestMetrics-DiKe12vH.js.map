{"version":3,"file":"backtestMetrics-DiKe12vH.js","sources":["../../src/utils/backtestMetrics.ts"],"sourcesContent":["import type { StrategyBacktestResult, Trade } from '@/types';\n\nfunction getSortedTrades(trades: Trade[]): Trade[] {\n  const sortedTrades = trades.slice().sort((a, b) => (a.profit_ratio ?? 0) - (b.profit_ratio ?? 0));\n  return sortedTrades;\n}\n\nfunction getBestPair(trades: Trade[]) {\n  const value = trades[trades.length - 1];\n  if (!value) {\n    return 'N/A';\n  }\n  return `${value.pair} ${formatPercent(value.profit_ratio, 2)}`;\n}\n\nfunction getWorstPair(trades: Trade[]) {\n  const value = trades[0];\n  if (!value) {\n    return 'N/A';\n  }\n  return `${value.pair} ${formatPercent(value.profit_ratio, 2)}`;\n}\n\nfunction useFormatPriceStake(stake_currency_decimals: number, stake_currency: string) {\n  const formatPriceStake = (price) => {\n    return `${formatPrice(price, stake_currency_decimals)} ${stake_currency}`;\n  };\n  return formatPriceStake;\n}\n\nexport function generateBacktestMetricRows(result: StrategyBacktestResult) {\n  const sortedTrades = getSortedTrades(result.trades);\n  const bestPair = getBestPair(sortedTrades);\n  const worstPair = getWorstPair(sortedTrades);\n  const pairSummary = result.results_per_pair[result.results_per_pair.length - 1];\n\n  const formatPriceStake = useFormatPriceStake(\n    result.stake_currency_decimals,\n    result.stake_currency,\n  );\n\n  // Transpose Result into readable format\n  const shortMetrics =\n    result.trade_count_short && result.trade_count_short > 0\n      ? [\n          { '___ ': '___' },\n          {\n            'Long / Short': `${result.trade_count_long} / ${result.trade_count_short}`,\n          },\n          {\n            'Total profit Long': `${formatPercent(\n              result.profit_total_long || 0,\n            )} | ${formatPriceStake(result.profit_total_long_abs)}`,\n          },\n          {\n            'Total profit Short': `${formatPercent(\n              result.profit_total_short || 0,\n            )} | ${formatPriceStake(result.profit_total_short_abs)}`,\n          },\n        ]\n      : [];\n\n  const tmp = [\n    {\n      'Total Profit': `${formatPercent(result.profit_total)} | ${formatPriceStake(\n        result.profit_total_abs,\n      )}`,\n    },\n    {\n      CAGR: `${result.cagr ? formatPercent(result.cagr) : 'N/A'}`,\n    },\n    {\n      Sortino: formatNumber(result.sortino, 2),\n    },\n    {\n      Sharpe: formatNumber(result.sharpe, 2),\n    },\n    {\n      Calmar: formatNumber(result.calmar, 2),\n    },\n    {\n      'System Quality Number (SQN)': formatNumber(result.sqn, 2),\n    },\n    {\n      [`Expectancy ${result.expectancy_ratio ? '(ratio)' : ''}`]: `${\n        result.expectancy\n          ? result.expectancy_ratio\n            ? `${formatNumber(result.expectancy, 2)} (${formatNumber(result.expectancy_ratio, 2)})`\n            : formatNumber(result.expectancy, 2)\n          : 'N/A'\n      }`,\n    },\n    {\n      'Profit factor': formatNumber(result.profit_factor, 3),\n    },\n    {\n      'Total trades / Daily Avg Trades': `${result.total_trades} / ${formatNumber(result.trades_per_day, 2)}`,\n    },\n    // { 'First trade': result.backtest_fi },\n    // { 'First trade Pair': result.backtest_best_day },\n    {\n      'Best day': `${formatPercent(result.backtest_best_day, 2)} | ${formatPriceStake(\n        result.backtest_best_day_abs,\n      )}`,\n    },\n    {\n      'Worst day': `${formatPercent(result.backtest_worst_day, 2)} | ${formatPriceStake(\n        result.backtest_worst_day_abs,\n      )}`,\n    },\n\n    {\n      'Win/Draw/Loss': `${pairSummary?.wins} / ${pairSummary?.draws} / ${pairSummary?.losses} ${\n        isNotUndefined(pairSummary?.winrate)\n          ? '(WR: ' +\n            formatPercent(\n              result.results_per_pair[result.results_per_pair.length - 1]?.winrate ?? 0,\n              2,\n            ) +\n            ')'\n          : ''\n      }`,\n    },\n    {\n      'Days win/draw/loss': `${result.winning_days} / ${result.draw_days} / ${result.losing_days}`,\n    },\n    {\n      // TODO: min/max/avg trade duration should be aligned with the terminal output\n      'Min. Duration winners': humanizeDurationFromSeconds(result.winner_holding_min_s),\n    },\n    {\n      'Avg. Duration winners': humanizeDurationFromSeconds(result.winner_holding_avg_s),\n    },\n    {\n      'Max. Duration winners': humanizeDurationFromSeconds(result.winner_holding_max_s),\n    },\n    {\n      'Min. Duration Losers': humanizeDurationFromSeconds(result.loser_holding_min_s),\n    },\n    {\n      'Avg. Duration Losers': humanizeDurationFromSeconds(result.loser_holding_avg_s),\n    },\n    {\n      'Max. Duration Losers': humanizeDurationFromSeconds(result.loser_holding_max_s),\n    },\n    {\n      'Max Consecutive Wins / Loss':\n        result.max_consecutive_wins === undefined\n          ? 'N/A'\n          : `${result.max_consecutive_wins} / ${result.max_consecutive_losses}`,\n    },\n    { 'Rejected entry signals': result.rejected_signals },\n    {\n      'Entry/Exit timeouts': `${result.timedout_entry_orders} / ${result.timedout_exit_orders}`,\n    },\n    {\n      'Canceled Trade Entries': result.canceled_trade_entries ?? 'N/A',\n    },\n    {\n      'Canceled Entry Orders': result.canceled_entry_orders ?? 'N/A',\n    },\n    {\n      'Replaced Entry Orders': result.replaced_entry_orders ?? 'N/A',\n    },\n\n    ...shortMetrics,\n\n    { ___: '___' },\n    { 'Min balance': formatPriceStake(result.csum_min) },\n    { 'Max balance': formatPriceStake(result.csum_max) },\n    { 'Market change': formatPercent(result.market_change) },\n    { '___  ': '___' },\n    {\n      'Max Drawdown (Account)': formatPercent(result.max_drawdown_account),\n    },\n    {\n      'Max Drawdown ABS': formatPriceStake(result.max_drawdown_abs),\n    },\n    {\n      'Drawdown duration': result.drawdown_duration ?? 'N/A',\n    },\n    {\n      'Profit at Drawdown start | end': `${formatPriceStake(result.max_drawdown_high)} | ${formatPriceStake(\n        result.max_drawdown_low,\n      )}`,\n    },\n    { 'Drawdown start': timestampms(result.drawdown_start_ts) },\n    { 'Drawdown end': timestampms(result.drawdown_end_ts) },\n    { '___   ': '___' },\n\n    {\n      'Best Pair': `${result.best_pair.key} ${formatPercent(result.best_pair.profit_total)}`,\n    },\n    {\n      'Worst Pair': `${result.worst_pair.key} ${formatPercent(result.worst_pair.profit_total)}`,\n    },\n    { 'Best single Trade': bestPair },\n    { 'Worst single Trade': worstPair },\n  ];\n  return tmp;\n}\n\nfunction capitalizeFirstLetter(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction formatTradingMode(result: StrategyBacktestResult) {\n  if (!result.trading_mode || !result.margin_mode) {\n    return {};\n  }\n  const value =\n    result.trading_mode === 'spot'\n      ? capitalizeFirstLetter(result.trading_mode)\n      : `${capitalizeFirstLetter(result.margin_mode)} ${capitalizeFirstLetter(result.trading_mode)}`;\n  return { 'Trading Mode': value };\n}\n\nexport function generateBacktestSettingRows(result: StrategyBacktestResult) {\n  const formatPriceStake = useFormatPriceStake(\n    result.stake_currency_decimals,\n    result.stake_currency,\n  );\n  const tradingMode = formatTradingMode(result);\n\n  return [\n    { 'Backtesting from': timestampms(result.backtest_start_ts) },\n    { 'Backtesting to': timestampms(result.backtest_end_ts) },\n    ...(Object.keys(tradingMode).length !== 0 ? [tradingMode] : []),\n    {\n      'BT execution time': humanizeDurationFromSeconds(\n        result.backtest_run_end_ts - result.backtest_run_start_ts,\n      ),\n    },\n    { 'Max open trades': result.max_open_trades },\n    { Timeframe: result.timeframe },\n    { 'Timeframe Detail': result.timeframe_detail || 'N/A' },\n    { Timerange: result.timerange },\n    { Stoploss: formatPercent(result.stoploss, 2) },\n    { 'Trailing Stoploss': result.trailing_stop },\n    {\n      'Trail only when offset is reached': result.trailing_only_offset_is_reached,\n    },\n    { 'Trailing Stop positive': formatNumber(result.trailing_stop_positive) },\n    {\n      'Trailing stop positive offset': formatNumber(result.trailing_stop_positive_offset),\n    },\n    { 'Custom Stoploss': result.use_custom_stoploss },\n    { ROI: JSON.stringify(result.minimal_roi) },\n    {\n      'Use Exit Signal': result.use_exit_signal ?? result.use_sell_signal,\n    },\n    {\n      'Exit profit only': result.exit_profit_only ?? result.sell_profit_only,\n    },\n    {\n      'Exit profit offset': formatNumber(result.exit_profit_offset ?? result.sell_profit_offset),\n    },\n    { 'Enable protections': result.enable_protections },\n    {\n      'Starting balance': formatPriceStake(result.starting_balance),\n    },\n    {\n      'Final balance': formatPriceStake(result.final_balance),\n    },\n    {\n      'Avg. stake amount': formatPriceStake(result.avg_stake_amount),\n    },\n    {\n      'Total trade volume': formatPriceStake(result.total_volume),\n    },\n  ];\n}\n\n/** Selectable options for backtest charts.\n * selection happens through the settings page\n */\nexport const availableBacktestMetrics = ref([\n  { field: 'sqn', header: 'SQN' },\n  { field: 'cagr', header: 'Cagr' },\n  { field: 'calmar', header: 'Calmar' },\n  { field: 'expectancy', header: 'Expectancy' },\n  { field: 'profit_factor', header: 'Profit Factor' },\n  { field: 'sharpe', header: 'Sharpe' },\n  { field: 'sortino', header: 'Sortino' },\n  { field: 'max_drawdown_account', header: 'Max Drawdown', is_ratio: true },\n]);\n"],"names":["getSortedTrades","trades","a","b","getBestPair","value","formatPercent","getWorstPair","useFormatPriceStake","stake_currency_decimals","stake_currency","price","formatPrice","generateBacktestMetricRows","result","sortedTrades","bestPair","worstPair","pairSummary","formatPriceStake","shortMetrics","formatNumber","isNotUndefined","humanizeDurationFromSeconds","timestampms","capitalizeFirstLetter","str","formatTradingMode","generateBacktestSettingRows","tradingMode","availableBacktestMetrics","ref"],"mappings":"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"}