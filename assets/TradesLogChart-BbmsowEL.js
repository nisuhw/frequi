import{d as $,L as k,j as x,b7 as W,c as q,a as T,e as C,l as w,k as L,f as m,n as J,b as K,a6 as Q,t as O,b0 as H,r as X,b8 as Y,o as tt,b9 as et,V as ot,D as j,ba as at,A as st}from"./index-D29yCp72.js";import{u as S,s as D,i as I,a as A,b as B,c as R,d as z}from"./installCanvasRenderer-CZoFrcfF.js";import{e as M,o as N,c as V,i as Z,b as rt,d as E,f as nt,k as it}from"./chartZoom-HUt5osHp.js";function lt(l,o){const r=Math.min(...l),p=(Math.max(...l)-r)*1.01/o,u=[...Array(o).keys()].map(s=>[Math.round((r+s*p)*1e3)/1e3,0]);for(let s=0;s<l.length;s++){const e=Math.min(Math.floor((l[s]-r)/p),o-1);isNaN(e)||u[e][1]++}return u}const ct={class:"flex flex-col h-full relative"},dt={class:"grow mb-2"},P="Trade count",pt=$({__name:"ProfitDistributionChart",props:{trades:{},showTitle:{type:Boolean,default:!0}},setup(l){S([N,I,A,V,B,R,z]);const o=l,r=k(),_=[{text:"10",value:10},{text:"15",value:15},{text:"20",value:20},{text:"25",value:25},{text:"50",value:50}],p=x(()=>{const s=o.trades.filter(e=>W(e.profit_ratio)).map(e=>e.profit_ratio??0);return lt(s,r.profitDistributionBins)}),u=x(()=>({title:{text:"Profit distribution",left:"center",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:p.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[P],right:"5%",top:0,selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:P,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],grid:{...M,bottom:50},series:[{type:"bar",name:P,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(s,e)=>{const d=Q;return T(),q("div",ct,[C("div",dt,[l.trades?(T(),w(m(D),{key:0,option:m(u),autoresize:"",theme:m(r).chartTheme},null,8,["option","theme"])):L("",!0)]),C("div",{class:J(["z-2 absolute fixed-top flex items-center gap-10 ms-2",{"mx-auto":l.showTitle}]),"label-for":"input-bins",size:"sm"},[e[1]||(e[1]=C("label",{for:"input-bins"},"Bins",-1)),K(d,{id:"input-bins",modelValue:m(r).profitDistributionBins,"onUpdate:modelValue":e[0]||(e[0]=h=>m(r).profitDistributionBins=h),size:"small","option-label":"text","option-value":"value",class:"mt-1",options:_},null,8,["modelValue"])],2)])}}}),gt=O(pt,[["__scopeId","data-v-3c4dcbf5"]]),v="Profit",mt=$({__name:"CumProfitChart",props:{trades:{},openTrades:{default:()=>[]},showTitle:{type:Boolean,default:!0},profitColumn:{default:"profit_abs"}},setup(l){S([N,Z,I,A,V,rt,B,R,z]);const o=l,r=k(),_=H(),p=X(),u=x(()=>o.openTrades.reduce((t,n)=>t+(n.total_profit_abs??n[o.profitColumn]??0),0)),s=x(()=>{const t={},n=o.trades.slice().sort((c,f)=>c.close_timestamp>f.close_timestamp?1:-1);let i=0,y=!0;for(let c=0,f=n.length;c<f;c+=1){const a=n[c];if(a&&(y&&(y=!1,t[a.open_timestamp]?t[a.open_timestamp][a.botId]=i:t[a.open_timestamp]={profit:i,[a.botId]:i}),a.close_timestamp&&a[o.profitColumn])){i+=a[o.profitColumn];const g=t[a.close_timestamp];g?(g.profit+=a[o.profitColumn],g[a.botId]?g[a.botId]+=a[o.profitColumn]:g[a.botId]=i):t[a.close_timestamp]={profit:i,[a.botId]:i}}}const b=Object.entries(t).map(([c,f])=>({date:parseInt(c,10),profit:f.profit}));if(o.openTrades.length>0){let c=0,f=0;const a=b[b.length-1];if(a)c=a.profit??0,f=a.date??0;else{const G=o.openTrades[0];f=G?G.open_timestamp:0}const g=(c??0)+u.value;b.push({date:f,currentProfit:c});const U=Date.now()+1440*60*1e3;b.push({date:U,currentProfit:g})}return b});function e(t=!1){const{colorProfit:n,colorLoss:i}=_;return{dataset:{dimensions:["date","profit","currentProfit"],source:s.value},series:[{type:"line",name:"currentProfit",animation:t,lineStyle:{color:u.value>0?n:i,type:"dotted"},itemStyle:{color:u.value>0?n:i},encode:{x:"date",y:"currentProfit"}},{type:"line",name:v,animation:t,step:"end",lineStyle:{color:r.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:r.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]}}function d(t=!1){const n=e(t);p.value?.setOption(n,{replaceMerge:["series","dataset"]})}const h=Y(()=>o.trades,()=>{const t={title:{text:"Cumulative Profit",left:"center",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:i=>{const y=i[0].data.profit,b=i[0].data.currentProfit,c=b?`Projected profit (incl. unrealized): ${j(b,3)}`:`Profit: ${j(y,3)}`;return`${at(i[1].data.date)}<br />${i[1].marker}${c}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[v],right:"5%",top:0,selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:v,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{...M},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...E}]},n=e(!1);return t.series=n.series,t.dataset=n.dataset,t});return tt(()=>{}),et(()=>o.openTrades,()=>{d()},{throttle:60*1e3}),ot(()=>r.chartTheme,()=>{h.trigger()}),(t,n)=>l.trades?(T(),w(m(D),{key:0,ref_key:"chart",ref:p,option:m(h),theme:m(r).chartTheme,autoresize:""},null,8,["option","theme"])):L("",!0)}}),xt=O(mt,[["__scopeId","data-v-82bc82ad"]]),F="Profit %",ut="#9be0a8",ft=$({__name:"TradesLogChart",props:{trades:{},showTitle:{type:Boolean,default:!0}},setup(l){S([N,Z,I,A,V,B,R,z,nt,it]);const o=l,r=k(),_=H(),p=x(()=>{const s=[],e=o.trades.slice(0).sort((d,h)=>d.close_timestamp>h.close_timestamp?1:-1);for(let d=0,h=e.length;d<h;d+=1){const t=e[d];if(t){const n=[d,((t.profit_ratio??0)*100).toFixed(2),t.pair,t.botName,st(t.close_timestamp),t.is_short===void 0||!t.is_short?"Long":"Short"];s.push(n)}}return s}),u=x(()=>{const s=p.value.length>0?(1-50/p.value.length)*100:100;return{title:{text:"Trades log",left:"center",show:o.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:p.value},tooltip:{trigger:"axis",formatter:e=>{const d=e[0].data[3]?` | ${e[0].data[3]}`:"";return`${e[0].data[2]} | ${e[0].data[5]} ${d}<br>${e[0].data[4]}<br>Profit ${e[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",show:!1},yAxis:[{type:"value",name:F,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{...M,left:80},dataZoom:[{type:"inside",start:s,end:100},{bottom:10,start:s,end:100,...E}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:_.colorLoss},{min:0,color:_.colorProfit}]}],series:[{type:"bar",name:F,barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:r.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:ut}}]}});return(s,e)=>l.trades.length>0?(T(),w(m(D),{key:0,option:m(u),autoresize:"",theme:m(r).chartTheme},null,8,["option","theme"])):L("",!0)}}),yt=O(ft,[["__scopeId","data-v-1531f53a"]]);export{yt as _,xt as a,gt as b};
//# sourceMappingURL=TradesLogChart-BbmsowEL.js.map
