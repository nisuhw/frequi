{"version":3,"file":"PeriodBreakdown.vue_vue_type_script_setup_true_lang-D4do-mnd.js","sources":["../../src/components/charts/TimePeriodChart.vue","../../src/components/ftbot/PeriodBreakdown.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport ECharts from 'vue-echarts';\n// import { EChartsOption } from 'echarts';\n\nimport { use } from 'echarts/core';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { LineChart, BarChart } from 'echarts/charts';\nimport {\n  DatasetComponent,\n  GridComponent,\n  LegendComponent,\n  TitleComponent,\n  TooltipComponent,\n  TransformComponent,\n  VisualMapComponent,\n} from 'echarts/components';\n\nimport { registerTransform } from 'echarts';\n\nimport type { TimeSummaryCols, TimeSummaryReturnValue } from '@/types';\nimport type { EChartsOption, LinearGradientObject } from 'echarts';\n\nuse([\n  BarChart,\n  LineChart,\n  CanvasRenderer,\n  GridComponent,\n  DatasetComponent,\n  LegendComponent,\n  TitleComponent,\n  TooltipComponent,\n  VisualMapComponent,\n  TransformComponent,\n]);\n\nconst props = withDefaults(\n  defineProps<{\n    dailyStats: TimeSummaryReturnValue;\n    showTitle?: boolean;\n    profitCol: TimeSummaryCols;\n  }>(),\n  {\n    showTitle: true,\n  },\n);\n\n// Define Column labels here to avoid typos\nconst CHART_PROFIT = computed(() =>\n  props.profitCol === 'abs_profit' ? 'Absolute profit' : 'Relative profit',\n);\nconst CHART_TRADE_COUNT = 'Trade Count';\n\nconst settingsStore = useSettingsStore();\nconst colorStore = useColorStore();\n\nconst dailyChart = ref(null);\n\nconst absoluteMin = computed(\n  () =>\n    props.dailyStats.data.reduce(\n      (min, p) => (p[props.profitCol] < min ? p[props.profitCol] : min),\n      props.dailyStats.data[0]?.[props.profitCol] ?? 0,\n    ) * (props.profitCol === 'rel_profit' ? 100 : 1),\n);\nconst absoluteMax = computed(\n  () =>\n    props.dailyStats.data.reduce(\n      (max, p) => (p[props.profitCol] > max ? p[props.profitCol] : max),\n      props.dailyStats.data[0]?.[props.profitCol] ?? 0,\n    ) * (props.profitCol === 'rel_profit' ? 100 : 1),\n);\n\nregisterTransform(ftEchartsTransforms.multiple);\n\nconst colorStops: LinearGradientObject = {\n  type: 'linear',\n  x: 0,\n  y: 0,\n  x2: 1,\n  y2: 0,\n  colorStops: [\n    {\n      offset: 0,\n      color: colorStore.colorProfit, // color at 0%\n    },\n    {\n      offset: 0.5,\n      color: colorStore.colorProfit, // color at 50%\n    },\n    {\n      offset: 0.5,\n      color: colorStore.colorLoss, // color at 50%\n    },\n    {\n      offset: 1,\n      color: colorStore.colorLoss, // color at 100%\n    },\n  ],\n};\nconst dailyChartOptions: ComputedRef<EChartsOption> = computed(() => {\n  return {\n    title: {\n      text: 'Daily profit',\n      show: props.showTitle,\n    },\n    backgroundColor: 'rgba(0, 0, 0, 0)',\n    dataset: [\n      {\n        dimensions: ['date', props.profitCol, 'trade_count'],\n        source: props.dailyStats.data,\n      },\n      {\n        transform: {\n          type: 'ft:multiple',\n          config: { dimension: props.profitCol, factor: props.profitCol == 'rel_profit' ? 100 : 1 },\n        },\n      },\n    ],\n    tooltip: {\n      trigger: 'axis',\n      axisPointer: {\n        type: 'line',\n        label: {\n          backgroundColor: '#6a7985',\n        },\n      },\n    },\n    legend: {\n      data: [\n        {\n          name: CHART_PROFIT.value,\n          lineStyle: {\n            color: colorStops,\n          },\n          itemStyle: {\n            color: colorStops,\n          },\n        },\n        { name: CHART_TRADE_COUNT },\n      ],\n      top: 0,\n      right: '5%',\n    },\n    xAxis: [\n      {\n        type: 'category',\n      },\n    ],\n    visualMap: [\n      {\n        dimension: 1,\n        seriesIndex: 0,\n        show: false,\n        pieces: [\n          {\n            max: 0.0,\n            min: absoluteMin.value,\n            color: colorStore.colorLoss,\n          },\n          {\n            min: 0.0,\n            max: absoluteMax.value,\n            color: colorStore.colorProfit,\n          },\n        ],\n      },\n    ],\n    yAxis: [\n      {\n        type: 'value',\n        name: CHART_PROFIT.value,\n        splitLine: {\n          show: false,\n        },\n        nameRotate: 90,\n        nameLocation: 'middle',\n        nameGap: 35,\n        axisLabel: {\n          formatter: (value) => {\n            return props.profitCol === 'rel_profit' ? `${value}%` : `${value}`;\n          },\n        },\n      },\n      {\n        type: 'value',\n        name: CHART_TRADE_COUNT,\n        nameRotate: 90,\n        nameLocation: 'middle',\n        nameGap: 30,\n      },\n    ],\n    grid: {\n      left: '50',\n      right: '45',\n      bottom: '15%',\n    },\n    series: [\n      {\n        type: 'line',\n        name: CHART_PROFIT.value,\n        // Color is induced by visualMap\n        datasetIndex: 1,\n      },\n      {\n        type: 'bar',\n        name: CHART_TRADE_COUNT,\n        itemStyle: {\n          color: 'rgba(150,150,150,0.3)',\n        },\n        yAxisIndex: 1,\n        datasetIndex: 1,\n      },\n    ],\n  };\n});\n</script>\n\n<template>\n  <ECharts\n    v-if=\"dailyStats.data\"\n    ref=\"dailyChart\"\n    :option=\"dailyChartOptions\"\n    :theme=\"settingsStore.chartTheme\"\n    :style=\"{ height: '100%' }\"\n    autoresize\n  />\n</template>\n\n<style lang=\"css\" scoped>\n.echarts {\n  min-height: 240px;\n  height: 100%;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { TimeSummaryOptions } from '@/types';\n\nconst botStore = useBotStore();\nconst settingsStore = useSettingsStore();\n\nconst props = defineProps<{\n  multiBotView?: boolean;\n}>();\n\nconst hasWeekly = computed(\n  () => botStore.activeBot?.botFeatures?.weeklyMonthlyStats || props.multiBotView,\n);\n\nconst periodicBreakdownSelections = computed(() => {\n  const vals = [{ value: TimeSummaryOptions.daily, text: 'Days' }];\n  if (hasWeekly.value) {\n    vals.push({ value: TimeSummaryOptions.weekly, text: 'Weeks' });\n    vals.push({ value: TimeSummaryOptions.monthly, text: 'Months' });\n  }\n  return vals;\n});\n\nconst absRelSelections = ref([\n  { value: 'abs_profit', text: 'Abs $' },\n  { value: 'rel_profit', text: 'Rel %' },\n]);\n\nconst selectedStats = computed(() => {\n  if (props.multiBotView) {\n    switch (settingsStore.timeProfitPeriod) {\n      case TimeSummaryOptions.weekly:\n        return botStore.allWeeklyStatsSelectedBots;\n      case TimeSummaryOptions.monthly:\n        return botStore.allMonthlyStatsSelectedBots;\n      default:\n        return botStore.allDailyStatsSelectedBots;\n    }\n  }\n\n  switch (settingsStore.timeProfitPeriod) {\n    case TimeSummaryOptions.weekly:\n      return botStore.activeBot.weeklyStats;\n    case TimeSummaryOptions.monthly:\n      return botStore.activeBot.monthlyStats;\n    default:\n      return botStore.activeBot.dailyStats;\n  }\n});\n\nconst selectedStatsSorted = computed(() => {\n  // Sorted version for chart\n  return {\n    ...selectedStats.value,\n    data: selectedStats.value.data\n      ? Object.values(selectedStats.value.data).sort((a, b) => (a.date > b.date ? 1 : -1))\n      : [],\n  };\n});\n\nfunction refreshSummary() {\n  if (props.multiBotView) {\n    botStore.allGetTimeSummary(settingsStore.timeProfitPeriod);\n  } else {\n    botStore.activeBot.getTimeSummary(settingsStore.timeProfitPeriod);\n  }\n}\n\nonMounted(() => {\n  refreshSummary();\n});\n</script>\n\n<template>\n  <div class=\"flex flex-col h-full\">\n    <div v-if=\"!props.multiBotView\" class=\"mb-2\">\n      <h3 class=\"me-auto inline text-xl\">{{ hasWeekly ? 'Period' : 'Daily' }} Breakdown</h3>\n      <Button class=\"float-end\" severity=\"secondary\" @click=\"refreshSummary\">\n        <template #icon>\n          <i-mdi-refresh />\n        </template>\n      </Button>\n    </div>\n    <div class=\"flex align-center justify-between\">\n      <SelectButton\n        v-if=\"hasWeekly\"\n        id=\"order-direction\"\n        v-model=\"settingsStore.timeProfitPeriod\"\n        :options=\"periodicBreakdownSelections\"\n        name=\"radios-btn-default\"\n        size=\"small\"\n        :allow-empty=\"false\"\n        option-label=\"text\"\n        option-value=\"value\"\n        @change=\"refreshSummary\"\n      ></SelectButton>\n      <SelectButton\n        v-model=\"settingsStore.timeProfitPreference\"\n        name=\"radios-btn-select\"\n        size=\"small\"\n        :allow-empty=\"false\"\n        option-label=\"text\"\n        option-value=\"value\"\n        :options=\"absRelSelections\"\n        buttons\n        button-variant=\"outline-primary\"\n      >\n      </SelectButton>\n    </div>\n\n    <div\n      v-if=\"\n        props.multiBotView &&\n        (botStore.selectedBotCount <= 1 || settingsStore.timeProfitPreference != 'rel_profit')\n      \"\n    >\n      <TimePeriodChart\n        v-if=\"selectedStats\"\n        :daily-stats=\"selectedStatsSorted\"\n        :show-title=\"false\"\n        :profit-col=\"settingsStore.timeProfitPreference\"\n      />\n    </div>\n    <div v-else class=\"flex items-center justify-center h-full w-full p-2\">\n      Time period chart is only available when a single bot is selected and showing absolute profit.\n    </div>\n    <div v-if=\"!props.multiBotView\">\n      <DataTable size=\"small\" :value=\"selectedStats.data\">\n        <Column field=\"date\" header=\"Day\"></Column>\n        <Column field=\"abs_profit\" header=\"Profit\">\n          <template #body=\"{ data, field }\">\n            {{ formatPrice(data[field], botStore.activeBot.stakeCurrencyDecimals) }}\n          </template>\n        </Column>\n        <Column\n          field=\"fiat_value\"\n          :header=\"`In ${botStore.activeBot.dailyStats.fiat_display_currency}`\"\n        >\n          <template #body=\"{ data, field }\">\n            {{ formatPrice(data[field], 2) }}\n          </template>\n        </Column>\n        <Column field=\"trade_count\" header=\"Trades\"></Column>\n        <Column\n          v-if=\"botStore.activeBot.botFeatures.advancedDailyMetrics\"\n          field=\"rel_profit\"\n          header=\"Profit%\"\n        >\n          <template #body=\"{ data, field }\">\n            {{ formatPercent(data[field], 2) }}\n          </template>\n        </Column>\n      </DataTable>\n    </div>\n  </div>\n</template>\n"],"names":["CHART_TRADE_COUNT","use","BarChart","LineChart","CanvasRenderer","GridComponent","DatasetComponent","LegendComponent","TitleComponent","TooltipComponent","VisualMapComponent","TransformComponent","props","__props","CHART_PROFIT","computed","settingsStore","useSettingsStore","colorStore","useColorStore","dailyChart","ref","absoluteMin","min","p","absoluteMax","max","registerTransform","ftEchartsTransforms","colorStops","dailyChartOptions","value","_createBlock","_unref","ECharts","botStore","useBotStore","hasWeekly","periodicBreakdownSelections","vals","TimeSummaryOptions","absRelSelections","selectedStats","selectedStatsSorted","a","b","refreshSummary","onMounted","_openBlock","_createElementBlock","_hoisted_1","_hoisted_2","_createElementVNode","_hoisted_3","_toDisplayString","_createVNode","_component_Button","_component_i_mdi_refresh","_hoisted_4","_component_SelectButton","_cache","$event","_hoisted_5","_component_TimePeriodChart","_hoisted_6","_hoisted_7","_component_DataTable","_component_Column","_withCtx","data","field","formatPrice"],"mappings":"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"}