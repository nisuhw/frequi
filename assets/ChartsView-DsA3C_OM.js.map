{"version":3,"file":"ChartsView-DsA3C_OM.js","sources":["../../src/stores/chartConfig.ts","../../src/views/ChartsView.vue"],"sourcesContent":["export const useChartConfigStore = defineStore(\n  'chartConfig',\n  () => {\n    const strategy = ref<string>('');\n    const useLiveData = ref<boolean>(false);\n    const selectedTimeframe = ref<string>('1h');\n    const timerange = ref<string>('');\n\n    return {\n      strategy,\n      useLiveData,\n      selectedTimeframe,\n      timerange,\n    };\n  },\n  {\n    persist: {\n      key: 'ftUIChartSettings',\n      pick: ['useLiveData'],\n    },\n  },\n);\n\nif (import.meta.hot) {\n  import.meta.hot.accept(acceptHMRUpdate(useChartConfigStore, import.meta.hot));\n}\n","<script setup lang=\"ts\">\nimport { useBotStore } from '@/stores/ftbotwrapper';\nimport { MarginMode, TradingMode } from '@/types';\nimport type { ExchangeSelection, Markets, MarketsPayload, PairHistoryPayload } from '@/types';\n\nconst botStore = useBotStore();\nconst chartStore = useChartConfigStore();\n\nconst finalTimeframe = computed<string>(() => {\n  return botStore.activeBot.isWebserverMode\n    ? chartStore.selectedTimeframe || botStore.activeBot.strategy.timeframe || ''\n    : botStore.activeBot.timeframe;\n});\n\nconst availablePairs = computed<string[]>(() => {\n  if (botStore.activeBot.isWebserverMode) {\n    if (chartStore.useLiveData) {\n      return Object.keys(markets.value?.markets || {}).sort() || [];\n    }\n    if (finalTimeframe.value && finalTimeframe.value !== '') {\n      const tf = finalTimeframe.value;\n      return botStore.activeBot.pairlistWithTimeframe\n        .filter(([_, timeframe]) => {\n          // console.log(pair, timeframe, tf);\n          return timeframe === tf;\n        })\n        .map(([pair]) => pair);\n    }\n    return botStore.activeBot.pairlist;\n  }\n  return botStore.activeBot.whitelist;\n});\n\nonMounted(() => {\n  if (botStore.activeBot.isWebserverMode) {\n    // Get available pairs for all timeframes\n    botStore.activeBot.getAvailablePairs({});\n  } else if (!botStore.activeBot.whitelist || botStore.activeBot.whitelist.length === 0) {\n    botStore.activeBot.getWhitelist();\n  }\n});\n\nfunction refreshOHLCV(pair: string, columns: string[]) {\n  console.log('Refreshing OHLCV for pair:', pair, finalTimeframe.value, 'with columns:', columns);\n  if (botStore.activeBot.isWebserverMode && finalTimeframe.value) {\n    const payload: PairHistoryPayload = {\n      pair: pair,\n      timeframe: finalTimeframe.value,\n      timerange: chartStore.timerange,\n      strategy: chartStore.strategy,\n      // freqaimodel: freqaiModel.value,\n      columns: columns,\n      live_mode: chartStore.useLiveData,\n    };\n    if (exchange.value.customExchange) {\n      payload.exchange = exchange.value.selectedExchange.exchange;\n      payload.trading_mode = exchange.value.selectedExchange.trade_mode.trading_mode;\n      payload.margin_mode = exchange.value.selectedExchange.trade_mode.margin_mode;\n    }\n    botStore.activeBot.getPairHistory(payload);\n  } else {\n    botStore.activeBot.getPairCandles({\n      pair: pair,\n      timeframe: finalTimeframe.value,\n      columns: columns,\n    });\n  }\n}\nconst exchange = ref<{\n  customExchange: boolean;\n  selectedExchange: ExchangeSelection;\n}>({\n  customExchange: false,\n  selectedExchange: {\n    exchange: botStore.activeBot.botState.exchange,\n    trade_mode: {\n      margin_mode: MarginMode.NONE,\n      trading_mode: TradingMode.SPOT,\n    },\n  },\n});\n\nconst markets = ref<Markets | null>(null);\nwatch(\n  () => chartStore.useLiveData,\n  async () => {\n    if (botStore.activeBot.isWebserverMode && chartStore.useLiveData) {\n      const payload: MarketsPayload = {};\n      if (exchange.value.customExchange) {\n        payload.exchange = exchange.value.selectedExchange.exchange;\n        payload.trading_mode = exchange.value.selectedExchange.trade_mode.trading_mode;\n        payload.margin_mode = exchange.value.selectedExchange.trade_mode.margin_mode;\n      }\n\n      markets.value = await botStore.activeBot.getMarkets(payload);\n    }\n  },\n  {\n    immediate: true,\n  },\n);\n</script>\n\n<template>\n  <div class=\"flex flex-col h-full\">\n    <!-- <div v-if=\"isWebserverMode\" class=\"me-auto ms-3\"> -->\n    <!-- Currently only available in Webserver mode -->\n    <!-- <b-form-checkbox v-model=\"historicView\">HistoricData</b-form-checkbox> -->\n    <!-- </div> -->\n    <div v-if=\"botStore.activeBot.isWebserverMode\" class=\"md:mx-3 mt-2 px-1\">\n      <Panel header=\"Settings\" toggleable>\n        <div\n          class=\"mb-2 border dark:border-surface-700 border-surface-300 rounded-md p-2 text-start\"\n        >\n          <div class=\"flex flex-row gap-5\">\n            <BaseCheckbox v-model=\"exchange.customExchange\" class=\"mb-2\">\n              Custom Exchange\n            </BaseCheckbox>\n            <span v-show=\"!exchange.customExchange\">\n              Current Exchange:\n              {{ botStore.activeBot.botState.exchange }}\n              {{ botStore.activeBot.botState.trading_mode }}\n            </span>\n          </div>\n          <Transition name=\"fade\">\n            <ExchangeSelect v-show=\"exchange.customExchange\" v-model=\"exchange.selectedExchange\" />\n          </Transition>\n        </div>\n        <div class=\"grid grid-cols-3 md:grid-cols-5 mx-1 gap-1 md:gap-2\">\n          <div class=\"text-start md:me-1 col-span-2\">\n            <span>Strategy</span>\n            <StrategySelect v-model=\"chartStore.strategy\" class=\"mt-1 mb-1\"></StrategySelect>\n            <BaseCheckbox\n              v-if=\"botStore.activeBot.botFeatures.chartLiveData\"\n              v-model=\"chartStore.useLiveData\"\n              class=\"align-self-center\"\n              title=\"Use live data from the exchange. Only use if you don't have data downloaded locally.\"\n            >\n              Use Live Data\n            </BaseCheckbox>\n          </div>\n          <div class=\"flex flex-col text-start\">\n            <span>Timeframe</span>\n            <TimeframeSelect v-model=\"chartStore.selectedTimeframe\" class=\"mt-1\" />\n          </div>\n          <TimeRangeSelect\n            v-model=\"chartStore.timerange\"\n            class=\"col-span-3 md:col-span-2\"\n          ></TimeRangeSelect>\n        </div>\n      </Panel>\n    </div>\n\n    <div class=\"md:mx-2 mt-2 pb-1 h-full\">\n      <CandleChartContainer\n        :available-pairs=\"availablePairs\"\n        :historic-view=\"botStore.activeBot.isWebserverMode\"\n        :timeframe=\"finalTimeframe\"\n        :trades=\"botStore.activeBot.trades\"\n        :timerange=\"botStore.activeBot.isWebserverMode ? chartStore.timerange : undefined\"\n        :strategy=\"botStore.activeBot.isWebserverMode ? chartStore.strategy : undefined\"\n        :plot-config-modal=\"false\"\n        @refresh-data=\"refreshOHLCV\"\n      >\n      </CandleChartContainer>\n    </div>\n  </div>\n</template>\n"],"names":["useChartConfigStore","defineStore","strategy","ref","useLiveData","selectedTimeframe","timerange","botStore","useBotStore","chartStore","finalTimeframe","computed","availablePairs","markets","tf","_","timeframe","pair","onMounted","refreshOHLCV","columns","payload","exchange","MarginMode","TradingMode","watch","_openBlock","_createElementBlock","_hoisted_1","_unref","_hoisted_2","_createVNode","_component_Panel","_createElementVNode","_hoisted_3","_hoisted_4","_component_BaseCheckbox","_cache","$event","_withDirectives","_toDisplayString","_vShow","_Transition","_component_ExchangeSelect","_hoisted_5","_hoisted_6","_component_StrategySelect","_createBlock","_hoisted_7","_component_TimeframeSelect","_component_TimeRangeSelect","_hoisted_8","_component_CandleChartContainer"],"mappings":"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"}