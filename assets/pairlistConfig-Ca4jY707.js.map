{"version":3,"file":"pairlistConfig-Ca4jY707.js","sources":["../../src/types/pairlists.ts","../../src/components/general/BaseStringList.vue","../../src/stores/pairlistConfig.ts"],"sourcesContent":["import type { BackgroundTaskResult } from './backgroundtasks';\nimport type { WhitelistResponse } from './blacklist';\nimport type { ExchangeSelectPayload } from './types';\n\nexport interface PairlistsResponse {\n  pairlists: Pairlist[];\n}\n\nexport interface PairlistEvalResponse extends BackgroundTaskResult {\n  result: WhitelistResponse;\n}\n\nexport interface Pairlist {\n  id?: string;\n  is_pairlist_generator: boolean;\n  name: string;\n  description: string;\n  showParameters: boolean;\n  params: Record<string, PairlistParameter>;\n}\n\nexport interface PairlistConfig {\n  name: string;\n  blacklist: string[];\n  pairlists: Pairlist[];\n}\n\nexport enum PairlistParamType {\n  string = 'string',\n  number = 'number',\n  boolean = 'boolean',\n  option = 'option',\n  list = 'list',\n}\n\nexport type PairlistParamValue = string | number | boolean | string[];\n\ninterface PairlistParameterBase {\n  description: string;\n  help: string;\n  type: PairlistParamType;\n}\n\nexport interface StringPairlistParameter extends PairlistParameterBase {\n  type: PairlistParamType.string;\n  value?: string;\n  default: string;\n}\n\nexport interface NumberPairlistParameter extends PairlistParameterBase {\n  type: PairlistParamType.number;\n  value?: number;\n  default: number;\n}\n\nexport interface BooleanPairlistParameter extends PairlistParameterBase {\n  type: PairlistParamType.boolean;\n  value?: boolean;\n  default: boolean;\n}\n\nexport interface OptionPairlistParameter extends PairlistParameterBase {\n  type: PairlistParamType.option;\n  options: string[];\n  value?: string;\n  default: string;\n}\n\nexport interface ListPairlistParameter extends PairlistParameterBase {\n  type: PairlistParamType.list;\n  value?: string[];\n  default: string;\n}\n\nexport type PairlistParameter =\n  | StringPairlistParameter\n  | NumberPairlistParameter\n  | BooleanPairlistParameter\n  | OptionPairlistParameter\n  | ListPairlistParameter;\n\nexport interface PairlistPayloadItem {\n  method: string;\n  [key: string]: string | number | boolean;\n}\n\nexport interface PairlistsPayload extends ExchangeSelectPayload {\n  pairlists: PairlistPayloadItem[];\n  blacklist: string[];\n  stake_currency: string;\n}\n","<script setup lang=\"ts\">\nconst values = defineModel<string[]>({ required: true });\nwithDefaults(\n  defineProps<{\n    placeholder?: string;\n    size?: 'small' | 'large';\n  }>(),\n  {\n    placeholder: '',\n    size: 'small',\n  },\n);\n</script>\n\n<template>\n  <div class=\"flex flex-row gap-2\">\n    <div class=\"flex gap-1 flex-col w-full\">\n      <div v-for=\"(val, idx) in values\" :key=\"idx\" class=\"flex flex-row gap-1\">\n        <InputText\n          v-model=\"values[idx]\"\n          size=\"small\"\n          class=\"w-full\"\n          :placeholder=\"placeholder\"\n        ></InputText>\n        <Button\n          severity=\"secondary\"\n          variant=\"outlined\"\n          title=\"Delete this value.\"\n          class=\"flex align-items-center justify-content-center\"\n          @click=\"values.splice(idx, 1)\"\n        >\n          <template #icon>\n            <i-mdi-delete />\n          </template>\n        </Button>\n      </div>\n    </div>\n    <Button\n      :title=\"`Add new value`\"\n      severity=\"secondary\"\n      class=\"mt-auto flex align-items-center justify-content-center\"\n      @click=\"values.push('')\"\n    >\n      <template #icon>\n        <i-mdi-plus-box-outline />\n      </template>\n    </Button>\n  </div>\n</template>\n","import { useBotStore } from './ftbotwrapper';\n\nimport type {\n  ExchangeSelection,\n  Pairlist,\n  PairlistConfig,\n  PairlistParamValue,\n  PairlistPayloadItem,\n  PairlistsPayload,\n} from '@/types';\nimport { MarginMode, PairlistParamType, TradingMode } from '@/types';\n\nexport const usePairlistConfigStore = defineStore(\n  'pairlistConfig',\n  () => {\n    const botStore = useBotStore();\n\n    const evaluating = ref<boolean>(false);\n    const intervalId = ref<number>();\n    const stakeCurrency = ref<string>(botStore.activeBot?.stakeCurrency ?? 'USDT');\n    const whitelist = ref<string[]>([]);\n    const customExchange = ref<boolean>(false);\n    const selectedExchange = ref<ExchangeSelection>({\n      exchange: botStore.activeBot?.botState.exchange ?? '',\n      trade_mode: {\n        trading_mode: botStore.activeBot?.botState.trading_mode ?? TradingMode.SPOT,\n        margin_mode:\n          botStore.activeBot?.botState.trading_mode === TradingMode.FUTURES\n            ? MarginMode.ISOLATED\n            : MarginMode.NONE,\n      },\n    });\n\n    const config = ref<PairlistConfig>(makeConfig());\n    const savedConfigs = ref<PairlistConfig[]>([]);\n    const configName = ref<string>('');\n\n    const firstPairlistIsGenerator = computed<boolean>(() => {\n      // First pairlist must be a generator\n      if (config.value.pairlists[0]?.is_pairlist_generator) {\n        return true;\n      }\n      return false;\n    });\n\n    const pairlistValid = computed<boolean>(() => {\n      return firstPairlistIsGenerator.value && config.value.pairlists.length > 0;\n    });\n\n    const configJSON = computed(() => {\n      return JSON.stringify(configToPayloadItems(), null, 2);\n    });\n\n    const isSavedConfig = (name: string) =>\n      savedConfigs.value.findIndex((c) => c.name === name) > -1;\n\n    function addToConfig(pairlist: Pairlist, index: number) {\n      pairlist = structuredClone(toRaw(pairlist));\n      pairlist.showParameters = false;\n      if (!pairlist.id) {\n        pairlist.id = Date.now().toString(36) + Math.random().toString(36).substring(2);\n      }\n      for (const param in pairlist.params) {\n        if (pairlist.params[param]) {\n          pairlist.params[param].value = isNotUndefined(pairlist.params[param].default)\n            ? pairlist.params[param].default\n            : '';\n        }\n      }\n      config.value.pairlists.splice(index, 0, pairlist);\n    }\n\n    function removeFromConfig(index: number) {\n      config.value.pairlists.splice(index, 1);\n    }\n\n    function saveConfig(name = '') {\n      const i = savedConfigs.value.findIndex((c) => c.name === config.value.name);\n      config.value.name = name;\n\n      if (i > -1) {\n        savedConfigs.value[i] = structuredClone(toRaw(config.value));\n      } else {\n        savedConfigs.value.push(structuredClone(toRaw(config.value)));\n      }\n    }\n\n    function newConfig(name: string) {\n      const c = makeConfig({ name });\n      savedConfigs.value.push(c);\n      config.value = structuredClone(c);\n    }\n\n    function duplicateConfig(name = '') {\n      const c = makeConfig({\n        name,\n        pairlists: toRaw(config.value.pairlists) as [],\n        blacklist: toRaw(config.value.blacklist) as [],\n      });\n      savedConfigs.value.push(c);\n      config.value = structuredClone(c);\n    }\n\n    function deleteConfig() {\n      const i = savedConfigs.value.findIndex((c) => c.name === config.value.name);\n      if (i > -1) {\n        savedConfigs.value.splice(i, 1);\n        selectOrCreateConfig(\n          savedConfigs.value.length > 0 && savedConfigs.value[0]\n            ? savedConfigs.value[0].name\n            : 'default',\n        );\n      }\n    }\n\n    function selectOrCreateConfig(name: string) {\n      const c = savedConfigs.value.find((c) => name === c.name);\n      if (c) {\n        config.value = structuredClone(toRaw(c));\n      } else {\n        newConfig(name);\n      }\n    }\n\n    function makeConfig({ name = '', pairlists = [], blacklist = [] } = {}): PairlistConfig {\n      return { name, pairlists, blacklist };\n    }\n\n    function addToBlacklist() {\n      config.value.blacklist.push('');\n    }\n\n    function removeFromBlacklist(index: number) {\n      config.value.blacklist.splice(index, 1);\n    }\n\n    function duplicateBlacklist(configName: string) {\n      const conf = savedConfigs.value.find((c) => c.name === configName);\n      if (conf) {\n        config.value.blacklist = structuredClone(toRaw(conf.blacklist));\n      }\n    }\n\n    async function startPairlistEvaluation() {\n      const payload: PairlistsPayload = configToPayload();\n\n      evaluating.value = true;\n      try {\n        const { job_id: jobId } = await botStore.activeBot.evaluatePairlist(payload);\n        console.log('jobId', jobId);\n\n        intervalId.value = window.setInterval(async () => {\n          const res = await botStore.activeBot.getBackgroundJobStatus(jobId);\n          if (!res.running) {\n            clearInterval(intervalId.value);\n            const wl = await botStore.activeBot.getPairlistEvalResult(jobId);\n            evaluating.value = false;\n            if (wl.status === 'success') {\n              whitelist.value = wl.result.whitelist;\n            } else if (wl.error) {\n              showAlert(wl.error, 'error');\n              evaluating.value = false;\n            }\n          }\n        }, 1000);\n      } catch (error) {\n        showAlert('Evaluation failed', 'error');\n        evaluating.value = false;\n      }\n    }\n\n    function convertToParamType(type: PairlistParamType, value: PairlistParamValue) {\n      if (type === PairlistParamType.number) {\n        return Number(value);\n      } else if (type === PairlistParamType.boolean) {\n        return Boolean(value);\n      } else if (type === PairlistParamType.list) {\n        return value as string[];\n      } else {\n        return String(value);\n      }\n    }\n\n    function configToPayload(): PairlistsPayload {\n      const pairlists: PairlistPayloadItem[] = configToPayloadItems();\n      const c: PairlistsPayload = {\n        pairlists: pairlists,\n        stake_currency: stakeCurrency.value,\n        blacklist: config.value.blacklist,\n      };\n      if (customExchange.value) {\n        console.log('setting custom exchange props');\n        c.exchange = selectedExchange.value.exchange;\n        c.trading_mode = selectedExchange.value.trade_mode.trading_mode;\n        c.margin_mode = selectedExchange.value.trade_mode.margin_mode;\n      }\n      return c;\n    }\n\n    function configToPayloadItems() {\n      const pairlists: PairlistPayloadItem[] = [];\n      config.value.pairlists.forEach((config) => {\n        const pairlist = {\n          method: config.name,\n        };\n        for (const key in config.params) {\n          const param = config.params[key];\n          if (param?.value) {\n            pairlist[key] = convertToParamType(param.type, param.value);\n          }\n        }\n        pairlists.push(pairlist);\n      });\n\n      return pairlists;\n    }\n\n    watch(\n      () => config.value,\n      () => {\n        configName.value = config.value.name;\n      },\n      {\n        deep: true,\n      },\n    );\n\n    return {\n      evaluating,\n      whitelist,\n      config,\n      configJSON,\n      savedConfigs,\n      configName,\n      startPairlistEvaluation,\n      addToConfig,\n      removeFromConfig,\n      saveConfig,\n      duplicateConfig,\n      deleteConfig,\n      newConfig,\n      selectOrCreateConfig,\n      addToBlacklist,\n      removeFromBlacklist,\n      duplicateBlacklist,\n      isSavedConfig,\n      firstPairlistIsGenerator,\n      pairlistValid,\n      stakeCurrency,\n      customExchange,\n      selectedExchange,\n    };\n  },\n  {\n    persist: {\n      key: 'ftPairlistConfig',\n      pick: ['savedConfigs', 'configName'],\n    },\n  },\n);\n\nif (import.meta.hot) {\n  import.meta.hot.accept(acceptHMRUpdate(usePairlistConfigStore, import.meta.hot));\n}\n"],"names":["PairlistParamType","values","_useModel","__props","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_Fragment","_renderList","val","idx","_createVNode","_component_InputText","$event","_component_Button","_component_i_mdi_delete","_cache","_component_i_mdi_plus_box_outline","usePairlistConfigStore","defineStore","botStore","useBotStore","evaluating","ref","intervalId","stakeCurrency","whitelist","customExchange","selectedExchange","TradingMode","MarginMode","config","makeConfig","savedConfigs","configName","firstPairlistIsGenerator","computed","pairlistValid","configJSON","configToPayloadItems","isSavedConfig","name","c","addToConfig","pairlist","index","toRaw","param","isNotUndefined","removeFromConfig","saveConfig","i","newConfig","duplicateConfig","deleteConfig","selectOrCreateConfig","pairlists","blacklist","addToBlacklist","removeFromBlacklist","duplicateBlacklist","conf","startPairlistEvaluation","payload","configToPayload","jobId","wl","showAlert","convertToParamType","type","value","key","watch"],"mappings":"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"}